<!-- Loading overlay that will cover only the content area -->
@if (loading) {
<div class="loading-overlay" id="loadingOverlay">
  <!--<div class="loading-message">Loading...</div>-->
  <div class="spinner-blurred">
    <div class="spinner-border" style="width: 5rem; height: 5rem;" role="status"></div>
  </div>
</div>
}
<div class="row g-2">
  <h2 translate="navbar.genome"></h2>
  <div class="col-12 maps">
    <ul ngbNav #nav="ngbNav" class="nav-tabs justify-content-center">
      <li ngbNavItem>
        <button ngbNavLink translate="igv.mininav.explore-chromosome"></button>
        <ng-template ngbNavContent>
          <div class="d-flex justify-content-center">
            <button tabindex="0" role="button" [disabled]="!browser || (genes.length != 0) && (load_progress < 100)"
              color="accent" (click)="getInRangeGenes()" class="btn btn-mcaredb mb-1">
              <i class="fa fa-arrow-up"></i> {{ 'igv.page.p1.btn-get' | translate}}
            </button>
          </div>
        </ng-template>
      </li>
      <li ngbNavItem>
        <button ngbNavLink translate="igv.mininav.core-genes"></button>
        <ng-template ngbNavContent>
          <div class="row g-2">
            <div ngbAccordion>
              <div ngbAccordionItem>
                <h2 ngbAccordionHeader>
                  <button ngbAccordionButton>
                    <h3 class="mb-0" translate="igv.list"></h3>
                  </button>
                </h2>
                <div ngbAccordionCollapse>
                  <div ngbAccordionBody>
                    <div class="row">
                    @for (item of gene_interested; track item; let i = $index) {
                    <a tabindex="0" class="col-4 text-decoration-none fs-5" (click)="browser.search(item.name)"
                      href="javascript:void(0)">
                      {{item?.name}}
                    </a>
                    }
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="d-flex justify-content-center gap-1">
              <button tabindex="0" [disabled]="!this.browser || load_progress == 0"
                class="btn btn-link text-decoration-none" (click)="moveGenes(this.grouped_genes, 'left')">
                <i class="fa fa-chevron-left">
                </i>
                {{prevGene}}
              </button>
              <button tabindex="0" [disabled]="!this.browser || (genes.length != 0) && (load_progress < 100)"
                class="btn btn-mcaredb" (click)="getDiffExpGenesInterest()">
                <i class="fa fa-magnifying-glass">
                </i>
                {{ 'igv.page.p2.btn-get' | translate }}
              </button>
              <button tabindex="0" [disabled]="!this.browser || load_progress == 0"
                class="btn btn-link text-decoration-none" (click)="moveGenes(this.grouped_genes, 'right')">
                {{nextGene}}
                <i class="fa fa-chevron-right">
                </i>
              </button>
            </div>
          </div>
        </ng-template>
      </li>
      <li ngbNavItem>
        <button ngbNavLink translate="igv.mininav.search-genes"></button>
        <ng-template ngbNavContent>
          <div class="row g-2">
            <textarea tabindex="0" class="form-control"
              placeholder="Enter gene symbols or Ensembl IDs separated by commas: Myh6, Gata6, Tbx5, ENSMUSG00000001517, 21944, ..."
              [(ngModel)]="genesEntered"></textarea>
            <div class="d-flex justify-content-center gap-1">
              <button tabindex="0" [disabled]="!this.browser || load_progress == 0"
                class="btn btn-link text-decoration-none" (click)="moveGenes(this.grouped_genes, 'left')">
                <i class="fa fa-chevron-left">
                </i>
                {{prevGene}}
              </button>
              <button tabindex="0"
                [disabled]="!this.browser || genesEntered.length == 0 || (genes.length != 0) && (load_progress < 100)"
                class="btn btn-mcaredb" (click)="getDiffExpGenesEntered()">
                <i class="fa fa-magnifying-glass">
                </i>
                {{ 'igv.page.p3.btn-get' | translate}}
              </button>
              <button tabindex="0" [disabled]="!this.browser || load_progress == 0"
                class="btn btn-link text-decoration-none" (click)="moveGenes(this.grouped_genes, 'right')">
                {{nextGene}}
                <i class="fa fa-chevron-right">
                </i>
              </button>
            </div>
          </div>
        </ng-template>
      </li>
    </ul>
  </div>
  <div #igvdiv class="igv" part="igv"></div>
  <div [ngbNavOutlet]="nav"></div>
  @if (this.genes.length > 0) {
  <div class="col-lg-3 col-md-12">
    <div class="sidebar-sticky-top pt-2" [ngStyle]="{ top: 'var(--navbar-height)' }">
      <h4 translate="igv.filterarea.celltype"></h4>
      <!--<dx-tag-box style="width: 100%; flex: 1;" [items]="cell_types" [searchEnabled]="true"
          placeholder="Select Cell Type(s)" (onValueChanged)="onCellChanged($event)" [showClearButton]="true"
          [showSelectionControls]="true" [multiline]="false" [maxDisplayedTags]="5" [value]='cell_types'
        paginate='true'></dx-tag-box>-->
      <ng-select tabindex="0" [items]="cell_types" [searchable]="true" [clearable]="true"
        (onValueChanged)="onCellChanged($event)" placeholder="Select Cell Type(s)" [(ngModel)]="selected_cells"
        [selectableGroup]="true" [selectableGroupAsModel]="false" [closeOnSelect]="false" [addTag]="false"
        [multiple]="true">
        <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
          <div class="d-flex justify-content-left align-items-center" style="gap: .5rem">
            <input id="item-{{ index }}" type="checkbox" class="form-check-input me-0 mt-0"
              [ngModel]="item$.selected" />
            <label class="flex-grow-1 text-truncate" style="min-width: 0px !important;" for="item-{{index}}">
              {{ item }}
            </label>
          </div>
        </ng-template>
      </ng-select>
      <hr />
      <div class="progress mb-2" role="progressbar" aria-label="Example with label" aria-valuenow="25" aria-valuemin="0"
        aria-valuemax="100">
        <div class="progress-bar text-bg-mcaredb" [class.progress-bar-striped]="load_progress != 100"
          [class.progress-bar-animated]="load_progress != 100" [style.width]="load_progress + '%'">
          {{`${load_progress.toFixed(2)}%`}}</div>
      </div>
      <button tabindex="0" class="btn btn-mcaredb w-100" id="btn-apply-detail" [disabled]="!completely_loaded"
        (click)="subsetCorrectCellAndTissueTypes()">
        <i class="fa fa-arrows-rotate"></i> {{ 'igv.filterarea.apply' | translate }}
      </button>
      <hr />
      <h4 translate="igv.filterarea.legend"></h4>
      <div class="color-legend">
        <h6 tabindex="0" class="sg-up" tabindex="0" popoverTitle="Significantly Upregulated"
          ngbPopover="p &le; 0.05 (equivalent to -log10P-val &ge; 1.30103) and Log2FC &gt; 0.58"><i
            class="fa fa-angles-up"></i>{{'igv.filterarea.sg-up' | translate}}</h6>
        <h6 tabindex="0" class="sl-up" tabindex="0" data-bs-toggle="popover" data-bs-trigger="focus"
          popoverTitle="Slightly Upregulated"
          ngbPopover="p &le; 0.05 (equivalent to -log10P-val &ge; 1.30103) and 0.58 &ge; Log2FC &gt; 0.25"><i
            class="fa fa-chevron-up"></i>{{'igv.filterarea.sl-up' | translate}}</h6>
        <h6 tabindex="0" class="no-cg" tabindex="0" data-bs-toggle="popover" data-bs-trigger="focus"
          popoverTitle="No Change"
          ngbPopover="p &le; 0.05 (equivalent to -log10P-val &ge; 1.30103) and 0.25 &ge; Log2FC &ge; -0.25"><i
            class="fa fa-grip-lines"></i>{{'igv.filterarea.no-cg' | translate}}</h6>
        <h6 tabindex="0" class="sl-dn" tabindex="0" data-bs-toggle="popover" data-bs-trigger="focus"
          popoverTitle="Slightly Downregulated"
          ngbPopover="p &le; 0.05 (equivalent to -log10P-val &ge; 1.30103) and -0.25 &gt; Log2FC &ge; -0.58"><i
            class="fa fa-chevron-down"></i>{{'igv.filterarea.sl-dn' | translate}}</h6>
        <h6 tabindex="0" class="sg-dn" tabindex="0" data-bs-toggle="popover" data-bs-trigger="focus"
          popoverTitle="Significantly Downregulated"
          ngbPopover="p &le; 0.05 (equivalent to -log10P-val &ge; 1.30103) and -0.58 &gt; Log2FC"><i
            class="fa fa-angles-down"></i>{{'igv.filterarea.sg-dn' | translate}}</h6>
        <h6 tabindex="0" class="no-ft" tabindex="0" data-bs-toggle="popover" data-bs-trigger="focus"
          popoverTitle="Not have a significant fit" ngbPopover="p &gt; 0.05 (equivalent to -log10P-val &lt; 1.30103)"><i
            class="fa fa-xmark"></i>{{'igv.filterarea.no-ft' | translate}}</h6>
      </div>
      <hr />
      <small class="text-muted">{{'igv.filterarea.note1' | translate}}</small>
    </div>
  </div>
  }

  @if (this.genes.length > 0) {
  <div class="col-lg-9 col-md-12 mt-2" [class.searching]="loading">
    <div ngbAccordion>
      @for (gene_list of this.grouped_genes; track gene_list) {
      @if (gene_list[0]) {
      <div ngbAccordionItem>
        <h2 ngbAccordionHeader>
          <button ngbAccordionButton>
            <app-gene-card [gene_list]="gene_list" [indices]="selected_indices"
              [completely_loaded]="completely_loaded"></app-gene-card>
          </button>
        </h2>
        <div ngbAccordionCollapse>
          <div ngbAccordionBody>
            <app-gene-card-detail [gene_list]="gene_list" [indices]="selected_indices"
              [completely_loaded]="completely_loaded"></app-gene-card-detail>
          </div>
        </div>
      </div>
      }
      }
    </div>
  </div>
  }
</div>